From 404d4add0746c9586ab8bc15e7d7c69eaf30fa13 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Cl=C3=A9ment=20P=C3=A9ron?= <peron.clem@gmail.com>
Date: Sun, 15 Mar 2020 23:06:33 +0100
Subject: [PATCH 5/7] arm64: dts: allwinner: Enable PCIe for Beelink GS1

---
 .../dts/allwinner/sun50i-h6-beelink-gs1.dts   | 24 +++++++++++++++++--
 1 file changed, 22 insertions(+), 2 deletions(-)

diff --git a/arch/arm64/boot/dts/allwinner/sun50i-h6-beelink-gs1.dts b/arch/arm64/boot/dts/allwinner/sun50i-h6-beelink-gs1.dts
index 77cea2bfb58f..3419b4924ad9 100644
--- a/arch/arm64/boot/dts/allwinner/sun50i-h6-beelink-gs1.dts
+++ b/arch/arm64/boot/dts/allwinner/sun50i-h6-beelink-gs1.dts
@@ -51,13 +51,15 @@
 		regulator-always-on;
 	};
 
+	/* Regulator to supply RTL8822BEH and IOs */
 	reg_vcc33wifi: vcc33wifi {
 		compatible = "regulator-fixed";
 		regulator-name = "vcc33-wifi";
 		regulator-min-microvolt = <3300000>;
 		regulator-max-microvolt = <3300000>;
+		regulator-enable-ramp-delay = <100000>;
 		vin-supply = <&reg_vcc5v>;
-		gpio = <&r_pio 0 10 GPIO_ACTIVE_HIGH>; /* PL10 */
+		gpio = <&r_pio 0 8 GPIO_ACTIVE_HIGH>; /* PL8 */
 		enable-active-high;
 	};
 
@@ -69,6 +71,16 @@
 		vin-supply = <&reg_vcc33wifi>;
 	};
 
+	/* Internal RTL8822BEH Wi-Fi regulator */
+	reg_wifien: wifien {
+		compatible = "regulator-fixed";
+		regulator-name = "wifi-en";
+		regulator-enable-ramp-delay = <100000>;
+		vin-supply = <&reg_vcc33wifi>;
+		gpio = <&r_pio 1 3 GPIO_ACTIVE_HIGH>; /* PM3 */
+		enable-active-high;
+	};
+
 	sound-spdif {
 		compatible = "simple-audio-card";
 		simple-audio-card,name = "sun50i-h6-spdif";
@@ -133,7 +145,7 @@
 
 &mmc0 {
 	vmmc-supply = <&reg_cldo1>;
-	cd-gpios = <&pio 5 6 GPIO_ACTIVE_LOW>;
+	cd-gpios = <&pio 5 6 GPIO_ACTIVE_LOW>; /* PF6 */
 	bus-width = <4>;
 	status = "okay";
 };
@@ -151,6 +163,14 @@
 	status = "okay";
 };
 
+&pcie {
+	vcc-supply = <&reg_bldo2>;
+	vdd-supply = <&reg_dcdcd>;
+	slot-supply = <&reg_wifien>;
+	perst-gpio = <&pio 6 3 GPIO_ACTIVE_LOW>; /* PG3 */
+	status = "okay";
+};
+
 &pio {
 	vcc-pc-supply = <&reg_bldo2>;
 	vcc-pd-supply = <&reg_cldo1>;
-- 
2.20.1

